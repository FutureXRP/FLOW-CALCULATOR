<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FLOW Calculator (Simple)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f3f4f6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        .calculator {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
        }
        h1 {
            font-size: 24px;
            text-align: center;
            margin-bottom: 16px;
        }
        p {
            color: #4b5563;
            text-align: center;
            margin-bottom: 24px;
        }
        .input-group {
            margin-bottom: 16px;
        }
        label {
            display: block;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 4px;
        }
        input[type="number"], select {
            width: 100%;
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            box-sizing: border-box;
        }
        input[type="checkbox"] {
            margin-right: 8px;
        }
        .results {
            background-color: #f9fafb;
            padding: 16px;
            border-radius: 4px;
            margin-top: 24px;
        }
        .result-group {
            margin-bottom: 12px;
        }
        .result-label {
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 4px;
        }
        .result-value {
            color: #1f2937;
        }
        .results p {
            margin: 8px 0;
            text-align: left;
            display: flex;
            align-items: center;
        }
        .info-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            background-color: #3b82f6;
            color: white;
            text-align: center;
            border-radius: 50%;
            margin-left: 8px;
            cursor: pointer;
            position: relative;
            font-size: 12px;
            line-height: 16px;
        }
        .tooltip {
            visibility: hidden;
            width: 200px;
            background-color: #1f2937;
            color: white;
            text-align: left;
            border-radius: 4px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            top: -5px;
            left: 110%;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .info-icon:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
        .footer {
            text-align: center;
            color: #6b7280;
            font-size: 12px;
            margin-top: 16px;
        }
        .footer a {
            color: #3b82f6;
            text-decoration: none;
        }
        .highlight {
            font-weight: bold;
            color: #1f2937;
        }
    </style>
</head>
<body>
    <div class="calculator">
        <h1>FLOW Calculator</h1>
        <p>Calculate the Functional Liquidity Operating Worth for utility tokens like XRP.</p>
        
        <div class="input-group">
            <label>Settlement Volume Type</label>
            <select id="asvType">
                <option value="total" selected>Total (On-Chain + Off-Chain)</option>
                <option value="onchain">On-Chain Only</option>
            </select>
        </div>
        
        <div class="input-group">
            <label>Annual Settlement Volume ($ ASV)</label>
            <input type="number" id="asv" value="2000000000000" placeholder="e.g., 2000000000000 ($2T)">
        </div>
        
        <div class="input-group">
            <label>ASV Growth Rate (% per year)</label>
            <input type="number" id="asvGrowth" value="10" placeholder="e.g., 10 (10%)" step="0.1">
        </div>
        
        <div class="input-group">
            <label>Velocity (times per year)</label>
            <input type="number" id="velocity" value="10" placeholder="e.g., 10" step="0.1">
        </div>
        
        <div class="input-group">
            <label>Velocity Change Rate (% per year)</label>
            <input type="number" id="velocityChange" value="0" placeholder="e.g., -2 (-2%)" step="0.1">
        </div>
        
        <div class="input-group">
            <label>Forecast Horizon (years)</label>
            <input type="number" id="horizon" value="5" placeholder="e.g., 5" step="1">
        </div>
        
        <div class="input-group">
            <label>Total Circulating Supply (tokens)</label>
            <input type="number" id="totalSupply" value="100000000000" placeholder="e.g., 100000000000 (100B)">
        </div>
        
        <div class="input-group">
            <label>Locked Supply Percentage (%)</label>
            <input type="number" id="lockedSupply" value="50" placeholder="e.g., 50 (50%)" step="0.1">
        </div>
        
        <div class="input-group">
            <label>Additional Locked Supply Next Year (%)</label>
            <input type="number" id="additionalLock" value="0" placeholder="e.g., 10 (10%)" step="0.1">
        </div>
        
        <div class="input-group">
            <label>Yearly Burn Rate (tokens, optional)</label>
            <input type="number" id="burnRate" value="10000000" placeholder="e.g., 10000000 (10M)">
            <div style="margin-top: 8px;">
                <input type="checkbox" id="useBurn" checked>
                <label for="useBurn">Use Burn Rate</label>
            </div>
        </div>
        
        <div class="input-group">
            <label>Liquidity Buffer Ratio (optional)</label>
            <input type="number" id="buffer" value="0.15" placeholder="e.g., 0.15 (15%)" step="0.01">
            <div style="margin-top: 8px;">
                <input type="checkbox" id="useBuffer" checked>
                <label for="useBuffer">Use Liquidity Buffer</label>
            </div>
        </div>
        
        <div class="input-group">
            <label>Current Market Price ($)</label>
            <input type="number" id="currentPrice" value="0.60" placeholder="e.g., 0.60 ($0.60)" step="0.01">
        </div>
        
        <div class="results" id="results">
            <h2 style="font-size: 18px; font-weight: bold; margin-bottom: 12px;">Results</h2>
            <div class="result-group">
                <div class="result-label">Current Effective Circulating Supply</div>
                <div class="result-value" id="effectiveSupply">0</div>
            </div>
            <div class="result-group">
                <div class="result-label">Current Market Capitalization</div>
                <div class="result-value" id="marketCap">$0</div>
            </div>
            <div class="result-group">
                <div class="result-label">FLOW (Economic Base)</div>
                <div class="result-value" id="flow">$0</div>
            </div>
            <div class="result-group" id="flowAdjGroup">
                <div class="result-label">Adjusted FLOW (with buffer)</div>
                <div class="result-value" id="flowAdj">$0</div>
            </div>
            <p><strong>Implied Price per Token:</strong> <span id="price">$0.00</span></p>
            <p><strong>Future Price (in <span id="horizonDisplay">0</span> years):</strong> <span id="futurePrice">$0.00</span></p>
            <p><strong>FLOW Ratio (MC ÷ FLOW):</strong> <span id="flowRatio">0.00</span> <span class="info-icon">i<span class="tooltip">Market Cap ÷ FLOW. ~1 means price aligns with utility; <1 suggests undervaluation (price may rise if adoption grows); >1 indicates speculative premium.</span></span></p>
            <p><strong>FLOW Ratio (%):</strong> <span id="flowRatioPct">0.0%</span> <span class="info-icon">i<span class="tooltip">Market Cap as a percentage of FLOW. Below 100% suggests undervaluation (e.g., 15% means MC is 15% of utility base).</span></span></p>
            <p class="highlight"><strong>FLOW Premium (%):</strong> <span id="flowPremium">0.00%</span> <span class="info-icon">i<span class="tooltip">(FLOW − Market Cap) ÷ Market Cap × 100%. Positive means undervalued (potential for price growth); negative means overvalued.</span></span></p>
            <p><strong>FLOW-to-Price Ratio:</strong> <span id="flowToPrice">0.00</span> <span class="info-icon">i<span class="tooltip">FLOW implied price ÷ current market price. Above 1 means fair utility price is higher than current; below 1 means current price exceeds utility.</span></span></p>
            <p><strong>Fair Market Gap:</strong> <span id="fairMarketGap">0.00%</span> <span class="info-icon">i<span class="tooltip">Percentage price increase needed to match FLOW’s fair value. Positive means undervalued.</span></span></p>
            <p><strong>FLOW Yield:</strong> <span id="flowYield">0.00</span> <span class="info-icon">i<span class="tooltip">FLOW ÷ Market Cap. Higher values indicate more liquidity support per dollar of market cap, signaling strong utility.</span></span></p>
            <p><strong>FLOW Efficiency:</strong> <span id="flowEfficiency">0.00</span> <span class="info-icon">i<span class="tooltip">ASV ÷ Market Cap. Higher values show more settlement volume per dollar of market cap, indicating efficient utility.</span></span></p>
        </div>
        
        <p class="footer">
            Created by Matt Blair. Learn more in the <a href="#">FLOW White Paper</a>.
        </p>
    </div>

    <script>
        function calculateFlow() {
            const asv = parseFloat(document.getElementById('asv').value) || 0;
            const asvGrowth = parseFloat(document.getElementById('asvGrowth').value) || 0;
            const velocity = parseFloat(document.getElementById('velocity').value) || 1;
            const velocityChange = parseFloat(document.getElementById('velocityChange').value) || 0;
            const horizon = parseInt(document.getElementById('horizon').value) || 1;
            const totalSupply = parseFloat(document.getElementById('totalSupply').value) || 1;
            const lockedSupply = parseFloat(document.getElementById('lockedSupply').value) || 0;
            const additionalLock = parseFloat(document.getElementById('additionalLock').value) || 0;
            const burnRate = parseFloat(document.getElementById('burnRate').value) || 0;
            const useBurn = document.getElementById('useBurn').checked;
            const buffer = parseFloat(document.getElementById('buffer').value) || 0;
            const useBuffer = document.getElementById('useBuffer').checked;
            const asvType = document.getElementById('asvType').value;
            const currentPrice = parseFloat(document.getElementById('currentPrice').value) || 0;

            // Adjust ASV for type (placeholder: assume on-chain is 70% of total)
            const adjustedAsv = asvType === 'onchain' ? asv * 0.7 : asv;

            // Cache Math.pow results
            const asvGrowthFactor = Math.pow(1 + asvGrowth / 100, horizon);
            const velocityChangeFactor = Math.pow(1 + velocityChange / 100, horizon);

            // Calculate future ASV and velocity
            const futureAsv = adjustedAsv * asvGrowthFactor;
            const futureVelocity = velocity * velocityChangeFactor;

            // Calculate current effective supply (without future burn)
            const lockedFraction = Math.min(Math.max(lockedSupply / 100, 0), 1);
            const additionalLockFraction = Math.min(Math.max(additionalLock / 100, 0), 1);
            const currentEffectiveSupply = totalSupply * (1 - lockedFraction - additionalLockFraction);

            // Calculate future effective supply (with burn over horizon)
            let futureEffectiveSupply = currentEffectiveSupply;
            if (useBurn) {
                futureEffectiveSupply = Math.max(currentEffectiveSupply - burnRate * horizon, 1);
            }

            // Calculate FLOW
            const flow = adjustedAsv / velocity;
            const flowAdj = useBuffer ? flow * (1 + buffer) : flow;
            const price = flowAdj / currentEffectiveSupply;

            // Calculate future price
            const futureFlow = futureAsv / futureVelocity;
            const futureFlowAdj = useBuffer ? futureFlow * (1 + buffer) : futureFlow;
            const futurePrice = futureFlowAdj / futureEffectiveSupply;

            // Calculate current market cap and comparative metrics
            const marketCap = currentPrice * currentEffectiveSupply;
            const flowRatio = marketCap / flow;
            const flowRatioPct = (marketCap / flow) * 100;
            const flowPremium = ((flow - marketCap) / marketCap) * 100;
            const flowToPrice = price / currentPrice;
            const fairMarketGap = ((price - currentPrice) / currentPrice) * 100;
            const flowYield = flow / marketCap;
            const flowEfficiency = adjustedAsv / marketCap;

            // Update results
            document.getElementById('effectiveSupply').textContent = currentEffectiveSupply.toLocaleString('en-US', { maximumFractionDigits: 0 });
            document.getElementById('marketCap').textContent = '$' + marketCap.toLocaleString('en-US', { maximumFractionDigits: 0 });
            document.getElementById('flow').textContent = '$' + flow.toLocaleString('en-US', { maximumFractionDigits: 0 });
            document.getElementById('flowAdj').textContent = '$' + flowAdj.toLocaleString('en-US', { maximumFractionDigits: 0 });
            document.getElementById('price').textContent = '$' + price.toLocaleString('en-US', { maximumFractionDigits: 2 });
            document.getElementById('horizonDisplay').textContent = horizon;
            document.getElementById('futurePrice').textContent = '$' + futurePrice.toLocaleString('en-US', { maximumFractionDigits: 2 });
            document.getElementById('flowRatio').textContent = isFinite(flowRatio) ? flowRatio.toFixed(2) : 'N/A';
            document.getElementById('flowRatioPct').textContent = isFinite(flowRatioPct) ? flowRatioPct.toFixed(1) + '%' : 'N/A';
            document.getElementById('flowPremium').textContent = isFinite(flowPremium) ? flowPremium.toFixed(2) + '%' : 'N/A';
            document.getElementById('flowToPrice').textContent = isFinite(flowToPrice) ? flowToPrice.toFixed(2) : 'N/A';
            document.getElementById('fairMarketGap').textContent = isFinite(fairMarketGap) ? (fairMarketGap >= 0 ? '+' : '') + fairMarketGap.toFixed(2) + '%' : 'N/A';
            document.getElementById('flowYield').textContent = isFinite(flowYield) ? flowYield.toFixed(2) : 'N/A';
            document.getElementById('flowEfficiency').textContent = isFinite(flowEfficiency) ? flowEfficiency.toFixed(2) : 'N/A';

            // Hide Adjusted FLOW if buffer not used
            document.getElementById('flowAdjGroup').style.display = useBuffer ? 'block' : 'none';
        }

        // Run calculation on input change
        document.querySelectorAll('input, select').forEach(input => {
            input.addEventListener('input', calculateFlow);
            if (input.type === 'checkbox') {
                input.addEventListener('change', calculateFlow);
            }
        });

        // Initial calculation
        calculateFlow();
    </script>
</body>
</html>
